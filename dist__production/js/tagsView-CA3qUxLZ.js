const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/contextmenu-B5MjRrcX.js","js/@vue-5amejw8K.js","js/index-D30c5w24.js","js/pinia-CTGgt2hX.js","js/vue-demi-Dq6ymT-8.js","js/vue-router-Bq7HluqB.js","js/js-cookie-BXEMiIsG.js","js/@element-plus-YR8FD5Tz.js","js/nprogress-CwwpQnHY.js","js/@intlify-KwFOTgoq.js","css/nprogress.CSXic_Zd.css","js/axios-XtWrBBVz.js","js/qs-d0NUDaEV.js","js/side-channel-ABGcfzWN.js","js/get-intrinsic-Dcwdwnz4.js","js/es-errors-Bza6HHKb.js","js/has-symbols-BjfDv0FJ.js","js/has-proto-DxUgyt-t.js","js/function-bind-Ckw9YnhN.js","js/hasown-DTGZhiFA.js","js/call-bind-COXgxIYc.js","js/set-function-length-CYeVTiyi.js","js/define-data-property-DvIQPL4R.js","js/es-define-property-DwRRhIwF.js","js/gopd-CVOMcQVD.js","js/has-property-descriptors-CDOEcoVi.js","js/object-inspect-Da024_OR.js","js/element-plus-AyclcJdL.js","js/lodash-es-EFZEm3Z2.js","js/@vueuse-DWSxN83p.js","js/@popperjs-CpAfbxx4.js","js/@ctrl-D2oWfImC.js","js/dayjs-BeASU03D.js","js/async-validator-Cuo4gI4y.js","js/memoize-one-Ds0C_khL.js","js/normalize-wheel-es-Vn5vHDCm.js","js/@floating-ui-DT7V1Oc1.js","js/vue-i18n-agluwRAO.js","js/vue-CBwmpGZq.js","js/mitt-CNZ6avp8.js","js/vue-grid-layout-WvDAhvPt.js","css/index.BVvPMfFH.css","css/tailwindcss.B_OxdTrg.css","css/contextmenu.udZjbJFt.css"])))=>i.map(i=>d[i]);
import{a as e,u as a,d as t,c as s,o as i,e as l,b as r,S as n,O as o,_ as u}from"./index-D30c5w24.js";import{d as m,b as p,_ as c,k as d,G as v,Z as h,aj as w,j as g,e as f,ai as y,o as V,c as L,V as j,P as b,a as C,J as q,F as k,a9 as x,a3 as D,S as R,O as S,U as T,u as A,aU as I,n as P}from"./@vue-5amejw8K.js";import{u as _,b as O,o as U}from"./vue-router-Bq7HluqB.js";import{S as $}from"./sortablejs-brRwdIwn.js";import{s as E}from"./pinia-CTGgt2hX.js";import{a as W}from"./element-plus-AyclcJdL.js";import"./js-cookie-BXEMiIsG.js";import"./@element-plus-YR8FD5Tz.js";import"./nprogress-CwwpQnHY.js";import"./@intlify-KwFOTgoq.js";import"./axios-XtWrBBVz.js";import"./qs-d0NUDaEV.js";import"./side-channel-ABGcfzWN.js";import"./get-intrinsic-Dcwdwnz4.js";import"./es-errors-Bza6HHKb.js";import"./has-symbols-BjfDv0FJ.js";import"./has-proto-DxUgyt-t.js";import"./function-bind-Ckw9YnhN.js";import"./hasown-DTGZhiFA.js";import"./call-bind-COXgxIYc.js";import"./set-function-length-CYeVTiyi.js";import"./define-data-property-DvIQPL4R.js";import"./es-define-property-DwRRhIwF.js";import"./gopd-CVOMcQVD.js";import"./has-property-descriptors-CDOEcoVi.js";import"./object-inspect-Da024_OR.js";import"./vue-i18n-agluwRAO.js";import"./vue-CBwmpGZq.js";import"./mitt-CNZ6avp8.js";import"./vue-grid-layout-WvDAhvPt.js";/* empty css                    */import"./vue-demi-Dq6ymT-8.js";import"./lodash-es-EFZEm3Z2.js";import"./@vueuse-DWSxN83p.js";import"./@popperjs-CpAfbxx4.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-BeASU03D.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DT7V1Oc1.js";const z=["data-url","onContextmenu","onMousedown","onClick"],H={key:0,class:"iconfont icon-webicon318 layout-navbars-tagsview-ul-li-iconfont"},M=u(m({__name:"tagsView",setup(u){const m=I((()=>r((()=>import("./contextmenu-B5MjRrcX.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43])))),M=p([]),F=p(),K=p(),G=p(),J=e(),N=a(),X=e(),B=t(),{themeConfig:Q}=E(N),{tagsViewRoutes:Y}=E(X),{routesList:Z}=E(B),ee=s(),ae=_(),te=O(),se=c({routeActive:"",routePath:ae.path,dropdown:{x:"",y:""},sortable:"",tagsRefsIndex:0,tagsViewList:[],tagsViewRoutesList:[]}),ie=d((()=>Q.value.tagsStyle)),le=d((()=>Q.value)),re=d((()=>e=>i.setTagsViewNameI18n(e))),ne=e=>le.value.isShareTagsView?e.path===se.routePath:e.query&&Object.keys(e.query).length||e.params&&Object.keys(e.params).length?e.url?e.url===se.routeActive:e.path===se.routeActive:e.path===se.routePath,oe=e=>{n.set("tagsViewList",e)},ue=async()=>{se.routeActive=await ye(ae),se.routePath=await ae.meta.isDynamic?ae.meta.isDynamicPath:ae.path,se.tagsViewList=[],se.tagsViewRoutesList=Y.value,me()},me=async()=>{n.get("tagsViewList")&&le.value.isCacheTagsView?se.tagsViewList=await n.get("tagsViewList"):(await se.tagsViewRoutesList.map((e=>{var a;(null==(a=e.meta)?void 0:a.isAffix)&&!e.meta.isHide&&(e.url=ye(e),se.tagsViewList.push({...e}),ee.addCachedView(e))})),await de(ae.path,ae)),Le(le.value.isShareTagsView?se.routePath:se.routeActive)},pe=async(e,a)=>{var t,s;let i=(null==(t=null==a?void 0:a.meta)?void 0:t.isDynamic)?a.meta.isDynamicPath:e;if(se.tagsViewList.filter((e=>{var t,s;return e.path===i&&o((null==(t=null==a?void 0:a.meta)?void 0:t.isDynamic)?e.params?e.params:null:e.query?e.query:null,(null==(s=null==a?void 0:a.meta)?void 0:s.isDynamic)?(null==a?void 0:a.params)?null==a?void 0:a.params:null:(null==a?void 0:a.query)?null==a?void 0:a.query:null)})).length<=0){let e=se.tagsViewRoutesList.find((e=>e.path===i));if(!e)return!1;if(e.meta.isAffix)return!1;if(e.meta.isLink&&!e.meta.isIframe)return!1;(null==(s=null==a?void 0:a.meta)?void 0:s.isDynamic)?e.params=a.params:e.query=null==a?void 0:a.query,e.url=ye(e),se.tagsViewList.push({...e}),await ee.addCachedView(e),oe(se.tagsViewList)}},ce=(e,a)=>{var t;let s=(null==(t=null==a?void 0:a.meta)?void 0:t.isDynamic)?a.meta.isDynamicPath:e;se.tagsViewList.forEach((e=>{var t,i,l;e.path!==s||o((null==(t=null==a?void 0:a.meta)?void 0:t.isDynamic)?e.params?e.params:null:e.query?e.query:null,(null==(i=null==a?void 0:a.meta)?void 0:i.isDynamic)?(null==a?void 0:a.params)?null==a?void 0:a.params:null:(null==a?void 0:a.query)?null==a?void 0:a.query:null)||((null==(l=null==a?void 0:a.meta)?void 0:l.isDynamic)?e.params=a.params:e.query=null==a?void 0:a.query,e.url=ye(e),oe(se.tagsViewList))}))},de=(e,a)=>{P((async()=>{var t,s,i;let l;if(null==(t=null==a?void 0:a.meta)?void 0:t.isDynamic){if(le.value.isShareTagsView?await ce(e,a):await pe(e,a),se.tagsViewList.some((e=>{var t;return e.path===(null==(t=null==a?void 0:a.meta)?void 0:t.isDynamicPath)})))return oe(se.tagsViewList),!1;l=se.tagsViewRoutesList.find((e=>{var t;return e.path===(null==(t=null==a?void 0:a.meta)?void 0:t.isDynamicPath)}))}else{if(le.value.isShareTagsView?await ce(e,a):await pe(e,a),se.tagsViewList.some((a=>a.path===e)))return oe(se.tagsViewList),!1;l=se.tagsViewRoutesList.find((a=>a.path===e))}return!!l&&(!((null==(s=null==l?void 0:l.meta)?void 0:s.isLink)&&!l.meta.isIframe)&&((null==(i=null==a?void 0:a.meta)?void 0:i.isDynamic)?l.params=(null==a?void 0:a.params)?null==a?void 0:a.params:ae.params:l.query=(null==a?void 0:a.query)?null==a?void 0:a.query:ae.query,l.url=ye(l),await ee.addCachedView(l),await se.tagsViewList.push({...l}),void(await oe(se.tagsViewList))))}))},ve=async e=>{var a;const t=decodeURI(e);let s={};if(se.tagsViewList.forEach((e=>{e.transUrl=fe(e),e.transUrl?e.transUrl===fe(e)&&(s=e):e.path===t&&(s=e)})),!s)return!1;await ee.delCachedView(s),l.emit("onTagsViewRefreshRouterView",e),(null==(a=s.meta)?void 0:a.isKeepAlive)&&ee.addCachedView(s)},he=e=>{se.tagsViewList.map(((a,t,s)=>{var i;(null==(i=a.meta)?void 0:i.isAffix)||(le.value.isShareTagsView?a.path===e:a.url===e)&&(ee.delCachedView(a),se.tagsViewList.splice(t,1),setTimeout((()=>{(se.tagsViewList.length===t&&le.value.isShareTagsView?se.routePath===e:se.routeActive===e)?s[s.length-1].meta.isDynamic?t!==s.length?te.push({name:s[t].name,params:s[t].params}):te.push({name:s[s.length-1].name,params:s[s.length-1].params}):t!==s.length?te.push({path:s[t].path,query:s[t].query}):te.push({path:s[s.length-1].path,query:s[s.length-1].query}):(se.tagsViewList.length!==t&&le.value.isShareTagsView?se.routePath===e:se.routeActive===e)&&(s[t].meta.isDynamic?te.push({name:s[t].name,params:s[t].params}):te.push({path:s[t].path,query:s[t].query}))}),0))})),oe(se.tagsViewList)},we=e=>{let a={};return se.tagsViewList.forEach((t=>{t.transUrl=fe(t),t.transUrl?t.transUrl===fe(t)&&t.transUrl===e.commonUrl&&(a=t):t.path===decodeURI(e.path)&&(a=t)})),a||null},ge=async e=>{if(e.commonUrl=fe(e),!we(e))return W({type:"warning",message:"请正确输入路径及完整参数（query、params）"});const{path:a,name:t,params:s,query:i,meta:l,url:r}=we(e);switch(e.contextMenuClickId){case 0:l.isDynamic?await te.push({name:t,params:s}):await te.push({path:a,query:i}),ve(ae.fullPath);break;case 1:he(le.value.isShareTagsView?a:r);break;case 2:l.isDynamic?await te.push({name:t,params:s}):await te.push({path:a,query:i}),(e=>{n.get("tagsViewList")&&(se.tagsViewList=[],n.get("tagsViewList").map((e=>{var a;(null==(a=e.meta)?void 0:a.isAffix)&&!e.meta.isHide&&(e.url=ye(e),ee.delOthersCachedViews(e),se.tagsViewList.push({...e}))})),de(e,ae),oe(se.tagsViewList))})(a);break;case 3:n.get("tagsViewList")&&(ee.delAllCachedViews(),se.tagsViewList=[],n.get("tagsViewList").map((e=>{var a;(null==(a=e.meta)?void 0:a.isAffix)&&!e.meta.isHide&&(e.url=ye(e),se.tagsViewList.push({...e}),te.push({path:se.tagsViewList[se.tagsViewList.length-1].path}))})),oe(se.tagsViewList));break;case 4:(async e=>{const a=se.tagsViewList.find((a=>le.value.isShareTagsView?a.path===e:a.url===e));a.meta.isDynamic?await te.push({name:a.name,params:a.params}):await te.push({name:a.name,query:a.query}),J.setCurrenFullscreen(!0)})(le.value.isShareTagsView?a:r)}},fe=e=>{var a,t;let s=e.query&&Object.keys(e.query).length>0?e.query:e.params;if(!s)return"";let i="";for(let[l,r]of Object.entries(s))(null==(a=e.meta)?void 0:a.isDynamic)?i+=`/${r}`:i+=`&${l}=${r}`;return(null==(t=e.meta)?void 0:t.isDynamic)?e.isFnClick?decodeURI(e.path):`${e.path.split(":")[0]}${i.replace(/^\//,"")}`:`${e.path}${i.replace(/^&/,"?")}`},ye=e=>{var a;let t=e.query&&Object.keys(e.query).length>0?e.query:e.params;if(!t||Object.keys(t).length<=0)return e.path;let s="";for(let i in t)s+=t[i];return`${(null==(a=e.meta)?void 0:a.isDynamic)?e.meta.isDynamicPath:e.path}-${s}`},Ve=e=>{F.value.$refs.wrapRef.scrollLeft+=e.wheelDelta/4},Le=e=>{P((async()=>{let a=await se.tagsViewList;se.tagsRefsIndex=a.findIndex((a=>le.value.isShareTagsView?a.path===e:a.url===e)),P((()=>{if(M.value.length<=0)return!1;let e=M.value[se.tagsRefsIndex],a=se.tagsRefsIndex,t=M.value.length,s=M.value[0],i=M.value[M.value.length-1],l=F.value.$refs.wrapRef,r=l.scrollWidth,n=l.offsetWidth,o=l.scrollLeft,u=M.value[se.tagsRefsIndex-1],m=M.value[se.tagsRefsIndex+1],p=0,c=0;e===s?l.scrollLeft=0:e===i?l.scrollLeft=r-n:(p=0===a?s.offsetLeft-5:(null==u?void 0:u.offsetLeft)-5,c=a===t?i.offsetLeft+i.offsetWidth+5:m.offsetLeft+m.offsetWidth+5,c>o+n?l.scrollLeft=c-n:p<o&&(l.scrollLeft=p)),F.value.update()}))}))},je=async()=>{const e=document.querySelector(".layout-navbars-tagsview-ul");if(!e)return!1;se.sortable.el&&se.sortable.destroy(),se.sortable=$.create(e,{animation:300,dataIdAttr:"data-url",disabled:!le.value.isSortableTagsView,onEnd:()=>{const e=[];se.sortable.toArray().map((a=>{se.tagsViewList.map((t=>{t.url===a&&e.push({...t})}))})),oe(e)}})},be=async()=>{await je(),i.isMobile()&&se.sortable.el&&se.sortable.destroy()};return v((()=>{be(),window.addEventListener("resize",be),l.on("onCurrentContextmenuClick",(e=>{e.isFnClick=!0,ge(e)})),l.on("openOrCloseSortable",(()=>{je()})),l.on("openShareTagsView",(()=>{le.value.isShareTagsView&&(te.push("/home"),se.tagsViewList=[],se.tagsViewRoutesList.map((e=>{var a;(null==(a=e.meta)?void 0:a.isAffix)&&!e.meta.isHide&&(e.url=ye(e),se.tagsViewList.push({...e}))})))}))})),h((()=>{l.off("onCurrentContextmenuClick",(()=>{})),l.off("openOrCloseSortable",(()=>{})),l.off("openShareTagsView",(()=>{})),window.removeEventListener("resize",be)})),w((()=>{M.value=[]})),g((()=>{ue(),je()})),U((async e=>{se.routeActive=ye(e),se.routePath=e.meta.isDynamic?e.meta.isDynamicPath:e.path,await de(e.path,e),Le(le.value.isShareTagsView?se.routePath:se.routeActive)})),f((()=>Y.value),(e=>{if(e.length===se.tagsViewRoutesList.length)return!1;ue()}),{deep:!0}),(e,a)=>{const t=y("SvgIcon"),s=y("el-scrollbar");return V(),L("div",{class:q(["layout-navbars-tagsview",{"layout-navbars-tagsview-shadow":"classic"===le.value.layout}])},[j(s,{ref_key:"scrollbarRef",ref:F,onWheel:D(Ve,["prevent"])},{default:b((()=>[C("ul",{class:q(["layout-navbars-tagsview-ul",ie.value]),ref_key:"tagsUlRef",ref:G},[(V(!0),L(k,null,x(se.tagsViewList,((s,i)=>(V(),L("li",{key:i,class:q(["layout-navbars-tagsview-ul-li",{"is-active":ne(s)}]),"data-url":s.url,onContextmenu:D((e=>((e,a)=>{const{clientX:t,clientY:s}=a;se.dropdown.x=t,se.dropdown.y=s,K.value.openContextmenu(e)})(s,e)),["prevent"]),onMousedown:e=>((e,a)=>{var t;if(!(null==(t=e.meta)?void 0:t.isAffix)&&1===a.button){const a=Object.assign({},{contextMenuClickId:1,...e});ge(a)}})(s,e),onClick:e=>((e,a)=>{se.tagsRefsIndex=a,te.push(e),"columns"===le.value.layout&&(Z.value.find((a=>a.path.indexOf(`/${e.path.split("/")[1]}`)>-1)).children?le.value.isCollapse=!1:le.value.isCollapse=!0)})(s,i),ref_for:!0,ref:e=>{e&&(M.value[i]=e)}},[ne(s)?(V(),L("i",H)):R("",!0),!ne(s)&&le.value.isTagsviewIcon?(V(),S(t,{key:1,name:s.meta.icon,class:"pr5"},null,8,["name"])):R("",!0),C("span",null,T(re.value(s)),1),ne(s)?(V(),L(k,{key:2},[j(t,{name:"ele-RefreshRight",class:"ml5 layout-navbars-tagsview-ul-li-refresh",onClick:a[0]||(a[0]=D((a=>ve(e.$route.fullPath)),["stop"]))}),s.meta.isAffix?R("",!0):(V(),S(t,{key:0,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-active",onClick:D((e=>he(le.value.isShareTagsView?s.path:s.url)),["stop"])},null,8,["onClick"]))],64)):R("",!0),s.meta.isAffix?R("",!0):(V(),S(t,{key:3,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-three",onClick:D((e=>he(le.value.isShareTagsView?s.path:s.url)),["stop"])},null,8,["onClick"]))],42,z)))),128))],2)])),_:1},512),j(A(m),{dropdown:se.dropdown,ref_key:"contextmenuRef",ref:K,onCurrentContextmenuClick:ge},null,8,["dropdown"])],2)}}}),[["__scopeId","data-v-2ea2ca8c"]]);export{M as default};
